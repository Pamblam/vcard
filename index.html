<!DOCTYPE html>
<html>
	<head>
		<title>VCard Test</title>
	</head>
	<body>
		<script type="module">
			import {VCard} from "./vcard.js";
			
			(async ()=>{

				const download = (text) => {
					var element = document.createElement('a');
					element.setAttribute('href', 'data:text/x-vcard;charset=utf-8,' + encodeURIComponent(text));
					element.setAttribute('download', 'vcard.vcf');
					element.style.display = 'none';
					document.body.appendChild(element);
					element.click();
					document.body.removeChild(element);
				}

				async function imgToDataURI(src) {
					return new Promise(done=>{
						var image = new Image();
						image.crossOrigin = 'Anonymous';
						image.onload = () => {
							var canvas = document.createElement('canvas');
							var context = canvas.getContext('2d');
							canvas.height = image.naturalHeight;
							canvas.width = image.naturalWidth;
							context.drawImage(image, 0, 0);
							done(canvas.toDataURL('image/jpeg'));
						};
						image.src = src;
					});
				}

				
				// let text = await new VCard()
				// 	.setVersion(3)
				// 	.setName('Pamela Mishaw')
				// 	.setNickname('Moon')
				// 	.setPhoto(await imgToDataURI('./profile.png'))
				// 	.setPhone('8136160999', '', ['cell', 'video'], true)
				// 	.setEmail('apples@gmial.com', true)
				// 	.setBday(new Date(1989, 0, 17))
				// 	.setAnniversary(new Date(1996, 7, 28))
				// 	.setAddress('123 main st', 'Clearwater', 'FL', '33584', 'USA', 'My House, in the middle of my street')
				// 	.setTitle('Super babe')
				// 	.setRole('Corn cleaner')
				// 	.setLogo(await imgToDataURI('./logo.png'))
				// 	.setOrg('Rob co, inc', 'Fart division', 'Butts department')
				// 	.setNote(`Woah, black betty; pambalam..`)
				// 	.setURL('http://www.google.com')
				// 	.render();

				// console.log(text);
				//download(text);

				let vcard = new VCard();
				let text = `key:value
key2;prop=1:value2
key3;prop2=asd;prop3=wer:value;value;value`;
 console.log(text);
				vcard.fromText(text);
				

			})();
		</script>
	</body>
</html>